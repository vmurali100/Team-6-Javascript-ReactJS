<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <form action="">
    <label for="address">address</label>
    <input type="text" name="" id="address"><br>
    <label for="city">city</label>
    <input type="text" name="" id="city"><br>
    <label for="street">street</label>
    <input type="text" name="" id="street"><br>
    <label for="id">id</label>
    <input type="text" name="" id="id"><br>
    <input type="text" name="" id="id" hidden><br>
    <label for="email">email</label>
    <input type="text" name="" id="email" onkeyup="validate()"><br>
    <p style="color:red ;display:none">please enter the valied email id</p>
    <label for="username">username</label>
    <input type="text" name="" id="username"><br>
    <label for="password">password</label>
    <input type="text" name="" id="password"><br>
    <label for="name">name</label>
    <input type="text" name="" id="name"><br>
    <label for="phone">phone</label>
    <input type="text" name="" id="phone"><br>
    <label for="__v">__v</label>
    <input type="text" name="" id="__v"><br>
    <button type="button" disabled>ADD USERS</button>
    <button type="button" id="getdata" onclick="getdatausers()">Adduser</button>
    <button type="button" id="update" onclick="updateuser()" style="display:none;">Updateuser</button>
  </form>
  <table border="1">
    <thead>
      <th>address</th>
      <th>id</th>
      <th>email</th>
      <th>username</th>
      <th>password</th>
      <th>name</th>
      <th>phone</th>
      <th>__v</th>
      <th>edit</th>
      <th>delete</th>
    </thead>
    <tbody></tbody>
  </table>
  <script>
    var alluser = []
    function getdatausers() {
      var getData = new XMLHttpRequest()
      getData.onreadystatechange = function () {
        if (getData.status == 200 && getData.readyState == 4) {
          alluser = JSON.parse(getData.response)
          console.log(alluser)
          displayuser(alluser)
        }
      }
      getData.open("GET", "http://localhost:3000/users1")
      getData.send()
    }
    function displayuser(data) {
      document.querySelector("tbody").innerHTML = ""
      data.forEach((user, i) => {
        var mytr = document.createElement("tr")
        for (a in user) {
          if (a !== "address" && a !== "name") {
            var mytd = document.createElement("td")
            mytd.innerHTML = user[a]
            mytr.appendChild(mytd)
          } else {
            var mytd = document.createElement("td")
            mytd.innerHTML = JSON.stringify(user[a])
            mytr.appendChild(mytd)
          }

        }
        var edittd = document.createElement("td")
        var editbtn = document.createElement("button")
        editbtn.setAttribute("onclick", "edituser(" + i + ")")
        editbtn.innerHTML = "edit"
        edittd.appendChild(editbtn)
        mytr.appendChild(edittd)

        var deletetd = document.createElement("td")
        var deletebtn = document.createElement("button")
        deletebtn.setAttribute("onclick", "deleteuser(" + i + ")")
        deletebtn.innerHTML = "delete"
        deletetd.appendChild(deletebtn)
        mytr.appendChild(deletetd)

        document.querySelector("tbody").appendChild(mytr)
      })
    }

    function deleteuser(i) {
      console.log(alluser[i])
      var deluser = new XMLHttpRequest()
      deluser.onreadystatechange = function () {
        if (deluser.status == 200 && deluser.readyState == 4) {
          console.log("deleted")
        }
      }
      deluser.open("DELETE", "http://localhost:3000/users1/" + alluser[i].id)
      deluser.setRequestHeader("Content-type", "application/json")
      deluser.send()
    }

    function edituser(i) {
      document.getElementById("getdata").style.display = "none"
      document.getElementById("update").style.display = "block"
      document.getElementById("address").value = alluser[i].address
      document.getElementById("id").value = alluser[i].id
      document.getElementById("email").value = alluser[i].email
      document.getElementById("username").value = alluser[i].username
      document.getElementById("password").value = alluser[i].password
      document.getElementById("name").value = alluser[i].name
      document.getElementById("phone").value = alluser[i].phone
      document.getElementById("__v").value = alluser[i].__v
    }

    function updateuser() {
      var user = {
        address: document.getElementById("address").value,
        id: document.getElementById("id").value,
        email: document.getElementById("email").value,
        username: document.getElementById("username").value,
        password: document.getElementById("password").value,
        name: document.getElementById("name").value,
        phone: document.getElementById("phone").value,
        __v: document.getElementById("__v").value,
      }
      var sendData = new XMLHttpRequest()
      sendData.onreadystatechange = function () {
        if (sendData.status == 201 && sendData.readyState == 4) {

          document.getElementById("getdata").style.display = "block"
          document.getElementById("update").style.display = "none"
          console.log("upted")
          getdatausers()
        }
      }
      sendData.open("PUT", "http://localhost:3000/users1/" + user.id)
      sendData.setRequestHeader("Content-type", "application/json")
      sendData.send(JSON.stringify(user))
    }

    function validate(){
      document.querySelector("p").style.display="block"
      var inputvalue=document.getElementById("email").value
      var formula=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
      if(formula.test(inputvalue)){
        document.querySelector("p").style.display="none"
        document.querySelector("button").removeAttribute("disabled")
      }else if(inputvalue.length==0){
        document.querySelector("p").style.display="none"
        document.querySelector("button").setAttribute("disabled")
      }else{
        document.querySelector("p").style.display="block"
        document.querySelector("button").setAttribute("disabled",true)
      }
    }

    getdatausers()
  </script>
</body>

</html>
<!-- {
    "address": {
      "geolocation": {
        "lat": "-37.3159",
        "long": "81.1496"
      },
      "city": "kilcoole",
      "street": "new road",
      "number": 7682,
      "zipcode": "12926-3874"
    },
    "id": 1,
    "email": "john@gmail.com",
    "username": "johnd",
    "password": "m38rmF$",
    "name": {
      "firstname": "john",
      "lastname": "doe"
    },
    "phone": "1-570-236-7033",
    "__v": 0
  } -->