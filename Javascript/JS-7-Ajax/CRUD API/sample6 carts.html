<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <form action="">
        <label for="id">id</label>
        <input type="text" name="" id="id"><br>
        <label for="userId">userId</label>
        <input type="text" name="" id="userId"><br>
        <label for="date">date</label>
        <input type="text" name="" id="date"><br>
        <label for="products">products</label>
        <input type="text" name="" id="products"><br>
        <label for="__v">__v</label>
        <input type="text" name="" id="__v"><br>
        <button type="button" onclick="addusercards()" id="add">adduser</button>
        <button type="button" onclick="updatecards()" id="update" style="display: none;">updateuser</button>
    </form>
    <table border="1">
      <thead>
        <th>id</th>
        <th>userId</th>
        <th>date</th>
        <th>products</th>
        <th>__v</th>
        <th>edit</th>
        <th>delete</th>
      </thead>
      <tbody></tbody>
    </table>
    <script>
      var allcarts=[]
      function addusercards(){
        var getData=new XMLHttpRequest()
            getData.onreadystatechange=function(){
                if(getData.status==200 && getData.readyState==4){
                  allcarts=JSON.parse(getData.response)
                    console.log(allcarts)
                    displaycards(allcarts)
                }
               
            }
            getData.open("GET","http://localhost:3000/carts")
            getData.send()
      }

      function displaycards(data){
            document.querySelector("tbody").innerHTML = ""
            data.forEach((user,i) => {
                var mytr = document.createElement("tr")
                for (a in user) {
                  if(a !=="products"){
                    var mytd = document.createElement("td")
                    mytd.innerHTML = user[a]
                    mytr.appendChild(mytd)
                  }else{
                    var mytd = document.createElement("td")
                    mytd.innerHTML = JSON.stringify(user[a])
                    mytr.appendChild(mytd)
                  }
                   
                }
                var edittd = document.createElement("td")
                var editbtn = document.createElement("button")
                editbtn.setAttribute("onclick", "edituser(" + i + ")")
                editbtn.innerHTML = "edit"
                edittd.appendChild(editbtn)
                mytr.appendChild(edittd)

                var deletetd = document.createElement("td")
                var deletebtn = document.createElement("button")
                deletebtn.setAttribute("onclick", "deleteuser(" + i + ")")
                deletebtn.innerHTML = "delete"
                deletetd.appendChild(deletebtn)
                mytr.appendChild(deletetd)

                document.querySelector("tbody").appendChild(mytr)
            })
        }

        function deleteuser(i){
          console.log(allcarts[i])
          var deluser=new XMLHttpRequest()
          deluser.onreadystatechange=function(){
            if(deluser.status==200 && deluser.readyState==4){
              console.log("deleted")
            }
          }
          deluser.open("DELETE","http://localhost:3000/carts/"+allcarts[i].id)
          deluser.setRequestHeader("Content-type", "application/json")
          deluser.send()
        }

        function edituser(i){
         document.getElementById("add").style.display="none"
         document.getElementById("update").style.display="block"
         document.getElementById("id").value=allcarts[i].id
         document.getElementById("userId").value=allcarts[i].userId
         document.getElementById("date").value=allcarts[i].date
         document.getElementById("products").value=allcarts[i].products
         document.getElementById("__v").value=allcarts[i].__v
        }

        function updatecards(){
         var user={
          id: document.getElementById("id").value,
          userId: document.getElementById("userId").value,
          date: document.getElementById("date").value,
          products: document.getElementById("products").value,
          __v:document.getElementById("__v").value,
         }
         var sendData=new XMLHttpRequest()
         sendData.onreadystatechange=function(){
           if(sendData.status==201 && sendData.readyState==4){
           
        document.getElementById("add").style.display="block"
        document.getElementById("update").style.display="none"
        addusercards()
        console.log("updeted")
           }
          
         }
         sendData.open("PUT","http://localhost:3000/carts/"+user.id)
           sendData.setRequestHeader("Content-type", "application/json")
           sendData.send(JSON.stringify(user))
        }
        addusercards()
    </script>
</body>
</html>
<!-- {
    "id": 1,
    "userId": 1,
    "date": "2020-03-02T00:00:02.000Z",
    "products": [
      {
        "productId": 1,
        "quantity": 4
      },
      {
        "productId": 2,
        "quantity": 1
      },
      {
        "productId": 3,
        "quantity": 6
      }
    ],
    "__v": 0
  }, -->