<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
   
</head>
<body>
<div>
    <h1>Address</h1>
            <label for="street">Street :</label><br>
            <input type="text" name="" id="street" onkeyup="validate()"><br><br>
            <label for="city">City, State :</label><br>
            <input type="text" name="" id="city" onkeyup="validate()"> <br><br>
            <label for="zipcode"> Zip Code:</label><br>
            <input type="text" name="" id="zipcode" onkeyup="validate()"><br><br>
            <label for="country"> Country :</label><br>
            <input type="text" name="" id="country" onkeyup="validate()"><br><br>
    <button type="button" id="okButton" onclick="okUser()" disabled >OK</button>
    <button type="button" id="update" onclick="updateuser()" style="display: none;"> update</button> 
</div>
<br><br><br>
<table border="1">
    <tr>
        <thead>
            <th>Street</th>
            <th>City,state</th>
            <th>zipcode</th>
            <th>Country</th>
            <th>Edit</th>
            <th>Delete</th>
        </thead>
    </tr>
    <tbody></tbody>
</table >

<script>
    var allUsers=JSON.parse(localStorage.getItem("allUsers"))
    index=null
    if(allUsers==null){
        allUsers=[]
    }
    function okUser(){
        document.querySelector("tbody").innerHTML=""
        var user={
            street:document.getElementById("street").value,
            city:document.getElementById("city").value,
            zipcode:document.getElementById("zipcode").value,
            country:document.getElementById("country").value
        }
        console.log(allUsers)
        allUsers.push(user)
        document.getElementById("okButton").setAttribute("disabled",true)
        localStorage.setItem("allUsers",JSON.stringify(allUsers))
        displayUsers(allUsers)
        cancelUser()
    }
    function cancelUser(){
        document.getElementById("street").value=""
        document.getElementById("city").value=""
        document.getElementById("zipcode").value=""
        document.getElementById("country").value=""
    }
    function displayUsers(data){
        document.querySelector("tbody").innerHTML = ""
        data.forEach((user,i)=>{
            var mytr=document.createElement("tr")
            for(a in user){
                var mytd=document.createElement("td")
                mytd.innerHTML=user[a]
                mytr.appendChild(mytd)
            }
            var editTd = document.createElement("td")
                var editBtn = document.createElement("button")
                editBtn.setAttribute("onclick", "editUser(" + i + ")")
                editBtn.innerHTML = "Edit"
                editTd.appendChild(editBtn)
                mytr.appendChild(editTd)
                //delete btn
                var deleteTd = document.createElement("td")
                var deleteBtn = document.createElement("button")
                deleteBtn.setAttribute("onclick", "deleteUser(" + i + ")")
                deleteBtn.innerHTML = "Delete"
                deleteTd.appendChild(deleteBtn)
                mytr.appendChild(deleteTd)
            document.querySelector("tbody").appendChild(mytr)
        })
    }
    function editUser(i) {
            console.log(allUsers[i])
            index=i
            document.getElementById("street").value=allUsers[i].street
        document.getElementById("city").value=allUsers[i].city
        document.getElementById("zipcode").value=allUsers[i].zipcode
        document.getElementById("country").value=allUsers[i].country
        document.getElementById("okButton").style.display="none"
        document.getElementById("update").style.display="block"
       

        }
        function deleteUser(i) {
            console.log("delete user called"+i)
            allUsers.splice(i, 1)
            displayUsers(allUsers)
        }
        displayUsers(allUsers)

        function validate(){
            var user={
            street:document.getElementById("street").value,
            city:document.getElementById("city").value,
            zipcode:document.getElementById("zipcode").value,
            country:document.getElementById("country").value
        }
        var check=false;
        for(a in user){
            if(user[a]==""){
                check=true
            }
        }
        if(check==true){
            document.getElementById("okButton").setAttribute("disabled",true)
        }else{
            document.getElementById("okButton").removeAttribute("disabled")
        }
        }
        function updateuser(){
            console.log("update user called")
            var user={
            street:document.getElementById("street").value,
            city:document.getElementById("city").value,
            zipcode:document.getElementById("zipcode").value,
            country:document.getElementById("country").value
        }
        allUsers[index]=user
        localStorage.setItem("allUsers",JSON.stringify(allUsers))
        displayUsers(allUsers)
        cancelUser()
        document.getElementById("okButton").style.display="block"
        document.getElementById("update").style.display="none"
        document.getElementById("okButton").setAttribute("disabled",true)
        }
        
</script>
</body>
</html>